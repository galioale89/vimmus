<script>
    function valida_cnpj() {
        var cnpj = document.getElementById('cnpj')

        if (cnpj.value.length == 2 || cnpj.value.length == 6) {
            cnpj.value += '.'
        }
        if (cnpj.value.length == 10) {
            cnpj.value += '/'
        }
        if (cnpj.value.length == 15) {
            cnpj.value += '-'
        }

        if (cnpj.value.length == 18) {

            var d1 = cnpj.value
            var p1 = d1.substring(0, 2)
            var p2 = d1.substring(3, 6)
            var p3 = d1.substring(7, 10)
            var p4 = d1.substring(11, 15)
            var p5 = d1.substring(16, 18)
            var numdoc = p1 + p2 + p3 + p4 + p5

            if (numdoc == "00000000000000" ||
                numdoc == "11111111111111" ||
                numdoc == "22222222222222" ||
                numdoc == "33333333333333" ||
                numdoc == "44444444444444" ||
                numdoc == "55555555555555" ||
                numdoc == "66666666666666" ||
                numdoc == "77777777777777" ||
                numdoc == "88888888888888" ||
                numdoc == "99999999999999") {
                cnpj.value = ''
            }

            // Valida DVs
            var tamanho = numdoc.length - 2
            var numeros = numdoc.substring(0, tamanho)
            var digitos = numdoc.substring(tamanho)
            var soma = 0
            var pos = tamanho - 7;
            for (i = tamanho; i >= 1; i--) {
                soma += numeros.charAt(tamanho - i) * pos--;
                if (pos < 2)
                    pos = 9;
            }
            var resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;
            if (resultado != digitos.charAt(0)) {
                cnpj.value = ''
            }

            tamanho = tamanho + 1;
            numeros = numdoc.substring(0, tamanho);
            soma = 0;
            pos = tamanho - 7;
            for (i = tamanho; i >= 1; i--) {
                soma += numeros.charAt(tamanho - i) * pos--;
                if (pos < 2)
                    pos = 9;
            }
            resultado = soma % 11 < 2 ? 0 : 11 - soma % 11;
            if (resultado != digitos.charAt(1)) {
                cnpj.value = ''
            }
        }
    };
    //Selecionar estados e cidades
    window.onload = function () {

        var estados = document.getElementById('estado');
        var cidades = document.getElementById('cidade');
        /*
        cidades.onchange = function () {
            if (cidades.value !== "") {
                //Basta modificar está linha conforme a necessidade
                window.location = "pagina.asp?estado=" + estados.value + "&cidade=" + cidades.value
            }
        };
        */
        new dgCidadesEstados({
            estado: estados,
            cidade: cidades,
            estadoVal: '<%=Request("estado") %>',
            cidadeVal: '<%=Request("cidade") %>'
        });

    };
</script>
<form action='/fornecedor/salvar' method='post'>
    <div class="cotainer mt-4" style="width: 50%;margin-left: 25%;">
        <div class="row">
            <label style='font-weight: bold;font-size:20px'> Cadastro de Fornecedores</label>
        </div>
        <hr>
        <input type="hidden" name='id' value='{{fornecedor._id}}'>
        <div class="container row mb-2">
            <div class="col-md-3 text-end">
                <label class='fw-bold col-form-label col-form-label-sm mb-1'>Nome: </label><br>
                <label class='fw-bold col-form-label col-form-label-sm mb-1'>Razão Social: </label><br>
                <label class='fw-bold col-form-label col-form-label-sm mb-1'>CNPJ: </label><br>
                <label class='fw-bold col-form-label col-form-label-sm mb-1'>Endereço: </label><br>
                <label class='fw-bold col-form-label col-form-label-sm mb-1'>Estado: </label><br>
                <label class='fw-bold col-form-label col-form-label-sm mb-1'>Cidade: </label><br>
                <label class='fw-bold col-form-label col-form-label-sm mb-1'>CEP: </label><br>
                <label class='fw-bold col-form-label col-form-label-sm mb-1'>Contato: </label><br>
                <label class='fw-bold col-form-label col-form-label-sm mb-1'>Telefone: </label><br>
                <label class='fw-bold col-form-label col-form-label-sm mb-1'>Prazo da prosposta: </label><br>
                <label class='fw-bold col-form-label col-form-label-sm mb-1'>Observações: </label><br>
                
            </div>
            <div class="col-md-8">
                <input type='text' name='nome' class='form-control form-control-sm mb-1' value='{{fornecedor.nome}}'>
                <input type='text' name='razao' class='form-control form-control-sm mb-1' value='{{fornecedor.razao}}'>
                <input type='text' class='form-control form-control-sm mb-1' maxlength="18" autocomplete="off" id='cnpj'
                    name='cnpj' onkeyup="valida_cnpj()" value='{{fornecedor.cnpj}}'>
                <input type='text' name='endereco' class='form-control form-control-sm mb-1'
                    value='{{fornecedor.endereco}}'>
                {{#if fornecedor._id}}
                <div class="row" style="margin-top: 3px">
                    <div class="col-md-5">
                        <label class='col-form-label col-form-label-sm'>{{fornecedor.uf}}</label>
                    </div>
                    <div class="col-md-7">
                        <select id="estado" name='uf' class='form-select form-select-sm mb-1'>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-5">
                        <label class='col-form-label col-form-label-sm'>{{fornecedor.cidade}}</label>
                    </div>
                    <div class="col-md-7">
                        <select id="cidade" name='cidade' class='form-select form-select-sm mb-1'>
                        </select>
                    </div>
                </div>
                {{else}}
                <select id="estado" name='uf' class='form-select form-select-sm mb-1'>
                    <option selected disabled>Selecione um estado...</option>
                </select>
                <select id="cidade" name='cidade' class='form-select form-select-sm mb-1'>
                    <option selected disabled>Selecione um cidade...</option>
                </select>
                {{/if}}
                <input type='number' name='cep' class='form-control form-control-sm mb-1' value='{{fornecedor.cep}}'>
                <input type='text' name='contato' class='form-control form-control-sm mb-1'
                    value='{{fornecedor.contato}}'>
                <input type='number' name='telefone' class='form-control form-control-sm mb-1'
                    value='{{fornecedor.telefone}}'>
                <input type='number' name='prazo' class='form-control form-control-sm mb-1'
                    value='{{fornecedor.prazo}}'>
                <textarea rows='4' name='observacao'
                    class='form-control form-control-sm mb-1'>{{fornecedor.observacao}}</textarea>
                                    
            </div>
            <div class="btn-group gap-2 mt-2" style="width: 50%;margin-left: 30%;">
                <a href='/fornecedor/novo' class='btn btn-sm btn-primary'>Novo</a>
                <button type='submit' class='btn btn-sm btn-success'>Aplicar</button>
            </div>
        </div>
    </div>
</form>